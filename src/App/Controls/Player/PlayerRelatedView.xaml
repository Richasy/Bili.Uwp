<local:PlayerComponent
    x:Class="Richasy.Bili.App.Controls.PlayerRelatedView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converter="using:Richasy.Bili.App.Resources.Converter"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:loc="using:Richasy.Bili.Locator.Uwp"
    xmlns:local="using:Richasy.Bili.App.Controls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
    xmlns:trigger="using:AdaptiveTriggerLibrary.Triggers.UserInterfaceTriggers"
    xmlns:uwp="using:Richasy.Bili.ViewModels.Uwp"
    d:DesignHeight="300"
    d:DesignWidth="400"
    mc:Ignorable="d">

    <UserControl.Resources>
        <converter:EpisodeTitleConverter x:Key="EpisodeTitleConverter" />
        <converter:EpisodeCoverConverter x:Key="EpisodeCoverConverter" />
        <converter:SeasonCoverConverter x:Key="SeasonCoverConverter" />
    </UserControl.Resources>

    <Grid CornerRadius="{StaticResource ControlCornerRadius}">
        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup x:Name="LayoutGroup">
                <VisualState x:Name="SideWideState">
                    <VisualState.StateTriggers>
                        <trigger:WindowWidthTrigger Condition="{StaticResource WideWindowThresholdWidth}" />
                    </VisualState.StateTriggers>
                </VisualState>
                <VisualState x:Name="SideNarrowState">
                    <VisualState.StateTriggers>
                        <trigger:WindowWidthTrigger Condition="{StaticResource MediumWindowThresholdWidth}" />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="DetailGrid.MaxWidth" Value="320" />
                    </VisualState.Setters>
                </VisualState>
                <VisualState x:Name="RowState">
                    <VisualState.StateTriggers>
                        <trigger:WindowWidthTrigger Condition="0" />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="DetailGrid.MaxWidth" Value="999" />
                    </VisualState.Setters>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>
        <muxc:NavigationView
            x:Name="Nav"
            Margin="0,-12,0,0"
            IsBackButtonVisible="Collapsed"
            IsPaneToggleButtonVisible="False"
            IsSettingsVisible="False"
            PaneDisplayMode="Top"
            SelectionChanged="OnNavSelectionChanged">
            <muxc:NavigationView.MenuItems>
                <muxc:NavigationViewItem
                    x:Name="PartsItem"
                    Content="{loc:LocaleLocator Name=Parts}"
                    Visibility="{x:Bind ViewModel.IsShowParts, Mode=OneWay}" />
                <muxc:NavigationViewItem
                    x:Name="EpisodeItem"
                    Content="{loc:LocaleLocator Name=Episodes}"
                    Visibility="{x:Bind ViewModel.IsShowEpisode, Mode=OneWay}" />
                <muxc:NavigationViewItem
                    x:Name="SeasonItem"
                    Content="{loc:LocaleLocator Name=Seasons}"
                    Visibility="{x:Bind ViewModel.IsShowSeason, Mode=OneWay}" />
                <muxc:NavigationViewItem
                    x:Name="RelatedViedeosItem"
                    Content="{loc:LocaleLocator Name=RelatedVideos}"
                    Visibility="{x:Bind ViewModel.IsShowRelatedVideos, Mode=OneWay}" />
                <muxc:NavigationViewItem x:Name="ReplyItem" Content="{loc:LocaleLocator Name=Reply}" />
                <muxc:NavigationViewItem
                    x:Name="SectionItem"
                    Content="{loc:LocaleLocator Name=Sections}"
                    Visibility="{x:Bind ViewModel.IsShowSection, Mode=OneWay}" />
            </muxc:NavigationView.MenuItems>
            <ScrollViewer HorizontalScrollMode="Disabled" VerticalScrollBarVisibility="Hidden">
                <Grid x:Name="DetailGrid" MaxWidth="360">
                    <local:VerticalRepeaterView
                        x:Name="RelatedVideoView"
                        HeaderVisibility="Collapsed"
                        ItemOrientation="Horizontal"
                        ItemsSource="{x:Bind ViewModel.RelatedVideoCollection}">
                        <local:VerticalRepeaterView.ItemTemplate>
                            <DataTemplate x:DataType="uwp:VideoViewModel">
                                <local:VideoItem
                                    MaxHeight="100"
                                    HorizontalCoverWidth="120"
                                    IsShowDanmakuCount="True"
                                    IsShowPlayCount="True"
                                    ViewModel="{x:Bind}" />
                            </DataTemplate>
                        </local:VerticalRepeaterView.ItemTemplate>
                    </local:VerticalRepeaterView>
                    <local:VerticalRepeaterView
                        x:Name="PartView"
                        HeaderVisibility="Collapsed"
                        ItemOrientation="Horizontal"
                        ItemsSource="{x:Bind ViewModel.VideoPartCollection}">
                        <local:VerticalRepeaterView.ItemTemplate>
                            <DataTemplate x:DataType="uwp:VideoPartViewModel">
                                <local:CardPanel
                                    Click="OnPartItemClickAsync"
                                    DataContext="{x:Bind}"
                                    IsChecked="{x:Bind IsSelected, Mode=OneWay}"
                                    IsEnableCheck="True"
                                    IsEnableHoverAnimation="False">
                                    <Grid Padding="12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="36" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <TextBlock
                                            VerticalAlignment="Center"
                                            FontWeight="Bold"
                                            Text="{x:Bind Data.Page.Page_}" />
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                            <TextBlock
                                                Style="{StaticResource BodyTextBlockStyle}"
                                                FontWeight="Bold"
                                                Text="{x:Bind Data.Page.Part}" />
                                            <TextBlock
                                                Style="{StaticResource CaptionTextBlockStyle}"
                                                Margin="0,4,0,0"
                                                FontWeight="Bold"
                                                Text="{x:Bind Data.Page.Desc}"
                                                Visibility="{x:Bind Data.Page.Desc, Converter={StaticResource ObjectToVisibilityConverter}}" />
                                        </StackPanel>
                                    </Grid>
                                </local:CardPanel>
                            </DataTemplate>
                        </local:VerticalRepeaterView.ItemTemplate>
                    </local:VerticalRepeaterView>
                    <local:VerticalRepeaterView
                        x:Name="EpisodeView"
                        HeaderVisibility="Collapsed"
                        ItemOrientation="Horizontal"
                        ItemsSource="{x:Bind ViewModel.EpisodeCollection}">
                        <local:VerticalRepeaterView.ItemTemplate>
                            <DataTemplate x:DataType="uwp:PgcEpisodeViewModel">
                                <local:CardPanel
                                    Click="OnEpisodeItemClickAsync"
                                    DataContext="{x:Bind}"
                                    IsChecked="{x:Bind IsSelected, Mode=OneWay}"
                                    IsEnableCheck="True"
                                    IsEnableHoverAnimation="False">
                                    <Grid
                                        Padding="12"
                                        HorizontalAlignment="Stretch"
                                        ColumnSpacing="12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <Grid
                                            Width="96"
                                            Height="64"
                                            VerticalAlignment="Center"
                                            CornerRadius="{StaticResource ControlCornerRadius}">
                                            <Image Source="{x:Bind Data.Cover, Converter={StaticResource EpisodeCoverConverter}}" Stretch="UniformToFill" />
                                        </Grid>
                                        <StackPanel
                                            Grid.Column="1"
                                            VerticalAlignment="Center"
                                            Spacing="4">
                                            <TextBlock
                                                Style="{StaticResource BodyTextBlockStyle}"
                                                FontWeight="Bold"
                                                Text="{x:Bind Data, Converter={StaticResource EpisodeTitleConverter}}" />
                                            <TextBlock
                                                Style="{StaticResource CaptionTextBlockStyle}"
                                                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                Text="{x:Bind Data.Duration, Converter={StaticResource MillisecondsDurationConverter}}" />
                                            <TextBlock
                                                Style="{StaticResource CaptionTextBlockStyle}"
                                                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                Text="{x:Bind Data.Subtitle}" />
                                        </StackPanel>
                                    </Grid>
                                </local:CardPanel>
                            </DataTemplate>
                        </local:VerticalRepeaterView.ItemTemplate>
                    </local:VerticalRepeaterView>
                    <local:VerticalRepeaterView
                        x:Name="SeasonView"
                        HeaderVisibility="Collapsed"
                        ItemOrientation="Vertical"
                        ItemsSource="{x:Bind ViewModel.SeasonCollection}"
                        MinWideItemHeight="200"
                        MinWideItemWidth="120">
                        <local:VerticalRepeaterView.ItemTemplate>
                            <DataTemplate x:DataType="uwp:PgcSeasonViewModel">
                                <local:CardPanel
                                    Click="OnSeasonItemClickAsync"
                                    DataContext="{x:Bind}"
                                    IsChecked="{x:Bind IsSelected, Mode=OneWay}"
                                    IsEnableCheck="True"
                                    IsEnableHoverAnimation="False">
                                    <Grid Padding="20,12" RowSpacing="12">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="*" />
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>
                                        <Grid HorizontalAlignment="Center" CornerRadius="{StaticResource ControlCornerRadius}">
                                            <Image Source="{x:Bind Data.Cover, Converter={StaticResource SeasonCoverConverter}}" ToolTipService.ToolTip="{x:Bind Data.SeasonTitle}" />
                                            <Border
                                                Margin="2,0,0,2"
                                                Padding="8,4"
                                                HorizontalAlignment="Left"
                                                VerticalAlignment="Bottom"
                                                Background="{ThemeResource AccentBadgeBackground}"
                                                CornerRadius="{StaticResource ControlCornerRadius}"
                                                Visibility="{x:Bind Data.Badge, Converter={StaticResource ObjectToVisibilityConverter}}">
                                                <TextBlock FontSize="12" Text="{x:Bind Data.Badge}" />
                                            </Border>
                                        </Grid>
                                        <TextBlock
                                            Style="{StaticResource BodyTextBlockStyle}"
                                            Grid.Row="1"
                                            HorizontalAlignment="Center"
                                            FontWeight="Bold"
                                            MaxLines="1"
                                            Text="{x:Bind Data.Title}"
                                            TextAlignment="Center"
                                            TextTrimming="CharacterEllipsis" />
                                    </Grid>
                                </local:CardPanel>
                            </DataTemplate>
                        </local:VerticalRepeaterView.ItemTemplate>
                    </local:VerticalRepeaterView>
                </Grid>
            </ScrollViewer>
        </muxc:NavigationView>

    </Grid>
</local:PlayerComponent>
